{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', path='champion_detail.css') }}">

<h2 class="champion-title">{{ champion.nombre }}</h2>

<div class="champion-info">
    <div class="champion-text">
        <p><strong>ID:</strong> {{ champion.id }}</p>
        <p><strong>Rol:</strong> {{ champion.rol }}</p>
        <p><strong>Activo:</strong> {{ "S铆" if champion.activo else "No" }}</p>

        <h3>Estad铆sticas</h3>
        <p><strong>Tasa de Victoria:</strong> {{ champion.tasa_victoria }}%</p>
        <p><strong>Tasa de Selecci贸n:</strong> {{ champion.tasa_seleccion }}%</p>
        <p><strong>Tasa de Baneo:</strong> {{ champion.tasa_baneo }}%</p>

        <h3>Perfil</h3>
        {% if champion.profile %}
            <p><strong>Descripci贸n:</strong> {{ champion.profile.descripcion }}</p>
            <p><strong>Historia:</strong> {{ champion.profile.historia }}</p>
        {% else %}
            <p>No hay perfil asignado.</p>
        {% endif %}
    </div>

    {% if champion.profile and champion.profile.foto %}
        <img src="/{{ champion.profile.foto }}" alt="Foto del campe贸n" class="champion-photo">
    {% endif %}
</div>

<hr>

<!--  GRFICA -->
<h3>Gr谩fica de estad铆sticas</h3>
<canvas id="statsChart" width="400" height="200"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById("statsChart");

    new Chart(ctx, {
        type: "bar",
        data: {
            labels: ["Winrate", "Pickrate", "Banrate"],
            datasets: [{
                label: "Porcentaje (%)",
                data: [
                    {{ champion.tasa_victoria }},
                    {{ champion.tasa_seleccion }},
                    {{ champion.tasa_baneo }}
                ],
                backgroundColor: "rgba(212, 175, 55, 0.6)", /* dorado transl煤cido */
                borderColor: "#d4af37", /* dorado s贸lido */
                borderWidth: 2,
                hoverBackgroundColor: "rgba(212, 175, 55, 0.85)",
                hoverBorderColor: "#f5d98a",
            }]
        },
        options: {
            plugins: {
                legend: {
                    labels: {
                        color: "#d4af37", /* texto dorado */
                        font: { size: 14 }
                    }
                }
            },
            scales: {
                x: {
                    ticks: { color: "#f0e6d2" }, /* texto crema */
                    grid: { color: "rgba(255,255,255,0.1)" }
                },
                y: {
                    ticks: { color: "#f0e6d2" },
                    grid: { color: "rgba(255,255,255,0.1)" }
                }
            }
        }
    });
</script>

<hr>

<h3>Items del Campe贸n</h3>
<ul>
{% for ci, item in items_con_porcentaje %}
    <li>{{ item.nombre }} ({{ item.tipo }}) - Uso: {{ ci.porcentaje_uso }}%</li>
{% else %}
    <li>No hay items agregados.</li>
{% endfor %}
</ul>

<hr>

<h3>Agregar Item</h3>
<form method="post" action="/champion-items/{{ champion.id }}/add">
    <label for="item_id">Item:</label>
    <select name="item_id" required>
        {% for item in all_items %}
            <option value="{{ item.id }}">{{ item.nombre }} ({{ item.tipo }})</option>
        {% endfor %}
    </select>

    <label for="porcentaje_uso">Porcentaje de uso:</label>
    <input type="number" step="0.1" name="porcentaje_uso" value="0.0">

    <button type="submit">Agregar Item</button>
</form>

<hr>

<h3>Enfrentamientos del Campe贸n</h3>
{% if champion.enfrentamientos %}
    <table>
        <thead>
            <tr>
                <th>Oponente</th>
                <th>Winrate</th>
                <th>Winrate Oponente</th>
            </tr>
        </thead>
        <tbody>
            {% for cvc in champion.enfrentamientos %}
            <tr>
                <td>{{ cvc.oponente.nombre }}</td>
                <td>{{ "%.1f"|format(cvc.winrate) }}%</td>
                <td>{{ "%.1f"|format(100 - cvc.winrate) }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No hay enfrentamientos registrados para este campe贸n.</p>
{% endif %}

<a href="/champions/list">Volver a la lista de campeones</a>

{% endblock %}
